#!/usr/bin/env -S Rscript --vanilla 


# pak for pak
options(
  repos =  c(CRAN = "https://cloud.r-project.org"),
  pak.no_extra_messages = TRUE
)

library(scribe)
ca <- command_args()
ca$add_description("pak : R package installation")
ca$add_description("console wrapper for calling pak::pak() from R.")
ca$add_example("pak fuj", "install {fuj} from CRAN")
ca$add_example("pak --d true -u github::tidyverse/dplyr github::tidyverse/tidyr", "install dev packages")
ca$add_argument(
  "...",
  "pkg",
  default = "local::.",
  info = "packages to install (default: local::.)"
)
ca$add_argument(
  "-d",
  "--dep",
  "--dependencies",
  default = NA,
  info = "dependencies (coerced)"
)
ca$add_argument(
  "-u",
  "--upgrade",
  action = "flag",
  default = FALSE,
  info = "upgrade (sets to TRUE)"
)
args <- ca$parse()

if (args$install) {
  params  <- list(package = args$pkg, execute = TRUE)
  writeLines(paste(c("pak::", format(do.call(call, c("pkg_system_requirements", params)))), collapse = ""))
  do.call(pak::pkg_system_requirements, params)
}

# remove the install flag
args$install <- NULL
writeLines(paste(c("pak::", format(do.call(call, c("pak", args)))), collapse = ""))
do.call(pak::pak, args)
